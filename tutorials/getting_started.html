
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting Started &#8212; hbmep v0.7.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "dark";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "dark";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=c62cc9a0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/getting_started';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Installation" href="../user/installation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.7.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="dark">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">hbmep v0.7.0</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user/installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Getting Started</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hbmep/hbmep" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hbmep/hbmep/edit/main/docs/tutorials/getting_started.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hbmep/hbmep/issues/new?title=Issue%20on%20page%20%2Ftutorials/getting_started.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/getting_started.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Getting Started</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A Simple Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-the-model">Build the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-model">Running the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-curves">Visualizing the curves</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mixture-extension">Mixture extension</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-parameters">Accessing parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-model">Saving the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-other-functions">Using other functions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h1>
<p>We’re going to demonstrate how to estimate recruitment curves using a hierarchical Bayesian model and the rectified-logistic function.</p>
<section id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="#a-simple-example" title="Link to this heading">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have trouble running the commands in this tutorial, please copy the command
and its output, then <a class="reference external" href="https://github.com/hbmep/hbmep/issues/new/choose">open an issue</a> on our GitHub repository. We’ll do our best to help you!</p>
</div>
<p>Begin by reading the <a class="reference external" href="https://raw.githubusercontent.com/hbmep/hbmep/docs-data/data/mock_data.csv">mock_data.csv</a> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/hbmep/hbmep/refs/heads/docs-data/data/mock_data.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df shape:		(245, 4)
df columns:		TMSIntensity, participant, PKPK_ECR, PKPK_FCR
All participants:	P1, P2, P3

First 5 rows:

   TMSIntensity participant  PKPK_ECR  PKPK_FCR
0         43.79          P1     0.197     0.048
1         55.00          P1     0.224     0.068
2         41.00          P1     0.112     0.110
3         43.00          P1     0.149     0.058
4         14.00          P1     0.014     0.011
</pre></div>
</div>
</div>
</div>
<p>This dataset contains TMS responses (peak-to-peak amplitude, in mV) for three participants (P1, P2, P3), recorded from two muscles (ECR and FCR).
The column <code class="docutils literal notranslate"><span class="pre">TMSIntensity</span></code> represents stimulation intensity in percent maximum stimulator output (0–100% MSO).</p>
</section>
<section id="build-the-model">
<h2>Build the model<a class="headerlink" href="#build-the-model" title="Link to this heading">#</a></h2>
<p id="id2">Next, we initialize a standard hierarchical Bayesian model. This step typically consists of assigning the model’s attributes to the appropriate dataframe columns, setting the sampling parameters, and choosing the recruitment curve function.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hbmep.model.standard</span><span class="w"> </span><span class="kn">import</span> <span class="n">HB</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">HB</span><span class="p">()</span>

<span class="c1"># Point to the respective columns in dataframe</span>
<span class="n">model</span><span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="s2">&quot;TMSIntensity&quot;</span>
<span class="n">model</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PKPK_ECR&quot;</span><span class="p">,</span> <span class="s2">&quot;PKPK_FCR&quot;</span><span class="p">]</span>

<span class="c1"># Specify the sampling parameters</span>
<span class="n">model</span><span class="o">.</span><span class="n">mcmc_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_chains&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;thinning&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;num_warmup&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Set the function</span>
<span class="n">model</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">rectified_logistic</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, these settings can be specified in an <a class="reference external" href="https://github.com/hbmep/hbmep/blob/docs-data/configs/config.toml">hbmep.toml</a> configuration file without having to change the code directly. See <a class="reference internal" href="working_with_toml.html#working-with-toml-configuration-files"><span class="std std-ref">Working with TOML configuration file</span></a> for details.</p>
</section>
<section id="running-the-model">
<h2>Running the model<a class="headerlink" href="#running-the-model" title="Link to this heading">#</a></h2>
<p>Before fitting the model, we can visualize the dataset. Since the plot is saved as a PDF, we need to specify an output path.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">current_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;dataset.pdf&quot;</span><span class="p">)</span>

<span class="c1"># Plot dataset and save it as a PDF</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/e4e40676a07bee3111019d09358405edfb6da9553c3eedbc88fa20ac16580151.png" src="../_images/e4e40676a07bee3111019d09358405edfb6da9553c3eedbc88fa20ac16580151.png" />
</div>
</div>
<p>The plot shows rows as participants and columns as muscles. The x-axis is TMS intensity (% MSO), and the y-axis is MEP peak-to-peak amplitude (mV).</p>
<p>Next, we process the dataframe by encoding categorical feature columns. This returns the same dataframe with encoded values, plus an encoder dictionary for mapping back to original labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Process the dataframe</span>
<span class="n">df</span><span class="p">,</span> <span class="n">encoder</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encoded participants:	0, 1, 2
Participant mapping:	0 -&gt; P1, 1 -&gt; P2, 2 -&gt; P3
</pre></div>
</div>
</div>
</div>
<p>Now we run the model to estimate curves.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run</span>
<span class="n">mcmc</span><span class="p">,</span> <span class="n">posterior</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Check convergence diagnostics</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary_df</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:2025-09-10 13:37:55,646:jax._src.xla_bridge:864: An NVIDIA GPU may be present on this machine, but a CUDA-enabled jaxlib is not installed. Falling back to cpu.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compiling.. :   0%|          | 0/2000 [00:00&lt;?, ?it/s]





Running chain 0:   0%|          | 0/2000 [00:02&lt;?, ?it/s]





Running chain 0:   5%|▌         | 100/2000 [00:05&lt;01:07, 28.04it/s]




Running chain 0:  10%|█         | 200/2000 [00:06&lt;00:36, 49.70it/s]


Running chain 0:  15%|█▌        | 300/2000 [00:07&lt;00:24, 70.24it/s]


Running chain 0:  20%|██        | 400/2000 [00:07&lt;00:17, 93.04it/s]





Running chain 0:  25%|██▌       | 500/2000 [00:08&lt;00:13, 107.38it/s]



Running chain 0:  30%|███       | 600/2000 [00:09&lt;00:11, 125.25it/s]


Running chain 0:  35%|███▌      | 700/2000 [00:09&lt;00:08, 146.29it/s]

Running chain 0:  40%|████      | 800/2000 [00:09&lt;00:07, 166.56it/s]
Running chain 0:  45%|████▌     | 900/2000 [00:10&lt;00:06, 182.06it/s]


Running chain 0:  50%|█████     | 1000/2000 [00:10&lt;00:05, 192.61it/s]


Running chain 0:  55%|█████▌    | 1100/2000 [00:11&lt;00:04, 193.64it/s]


Running chain 0:  60%|██████    | 1200/2000 [00:11&lt;00:04, 186.25it/s]


Running chain 0:  65%|██████▌   | 1300/2000 [00:12&lt;00:03, 183.70it/s]


Running chain 0:  70%|███████   | 1400/2000 [00:12&lt;00:03, 185.69it/s]


Running chain 0:  75%|███████▌  | 1500/2000 [00:13&lt;00:02, 178.36it/s]


Running chain 0:  80%|████████  | 1600/2000 [00:14&lt;00:02, 176.14it/s]


Running chain 0:  85%|████████▌ | 1700/2000 [00:14&lt;00:01, 178.43it/s]


Running chain 0:  90%|█████████ | 1800/2000 [00:15&lt;00:01, 179.44it/s]

Running chain 3: 100%|██████████| 2000/2000 [00:15&lt;00:00, 130.38it/s]

Running chain 2: 100%|██████████| 2000/2000 [00:15&lt;00:00, 129.55it/s]
Running chain 1: 100%|██████████| 2000/2000 [00:15&lt;00:00, 128.48it/s]
Running chain 0: 100%|██████████| 2000/2000 [00:16&lt;00:00, 122.60it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                mean     sd  hdi_2.5%  hdi_97.5%  mcse_mean  mcse_sd  ess_bulk  ess_tail  r_hat
a_loc         35.418  5.576    24.891     47.705      0.157    0.299    2321.0     869.0    1.0
a_scale       11.170  7.101     3.772     25.594      0.231    0.376    1611.0    1203.0    1.0
b_scale        0.189  0.115     0.061      0.381      0.003    0.013    1563.0    1594.0    1.0
g_scale        0.013  0.005     0.006      0.024      0.000    0.000    1047.0     975.0    1.0
h_scale        0.282  0.129     0.120      0.524      0.004    0.007    1054.0    1250.0    1.0
v_scale        4.547  2.913     0.246     10.230      0.050    0.040    2554.0    1966.0    1.0
c₁_scale       3.008  2.633     0.075      8.490      0.051    0.045    2077.0    2303.0    1.0
c₂_scale       0.280  0.102     0.125      0.493      0.003    0.003    1194.0    1728.0    1.0
a[0, 0]       31.900  0.463    30.731     32.637      0.016    0.021    1815.0     754.0    1.0
a[0, 1]       31.609  0.538    30.537     32.577      0.011    0.010    2845.0    2277.0    1.0
a[1, 0]       45.521  0.870    43.650     46.427      0.034    0.069    1385.0     650.0    1.0
a[1, 1]       44.842  0.815    43.216     46.156      0.017    0.022    2870.0    2747.0    1.0
a[2, 0]       30.066  0.431    29.251     30.719      0.010    0.022    2563.0    1600.0    1.0
a[2, 1]       31.175  0.673    29.987     32.482      0.012    0.020    3614.0    2677.0    1.0
b_raw[0, 0]    1.118  0.479     0.330      2.112      0.011    0.007    1767.0    1753.0    1.0
b_raw[0, 1]    1.372  0.550     0.419      2.458      0.010    0.009    2899.0    2533.0    1.0
b_raw[1, 0]    0.607  0.356     0.078      1.335      0.010    0.009    1399.0    2050.0    1.0
b_raw[1, 1]    0.495  0.312     0.040      1.110      0.006    0.006    1912.0    2230.0    1.0
b_raw[2, 0]    0.570  0.305     0.101      1.193      0.007    0.007    1773.0    2025.0    1.0
b_raw[2, 1]    0.321  0.215     0.024      0.743      0.005    0.005    1879.0    2145.0    1.0
g_raw[0, 0]    1.187  0.389     0.453      1.915      0.012    0.007    1048.0     983.0    1.0
g_raw[0, 1]    1.127  0.372     0.457      1.859      0.011    0.007    1038.0    1049.0    1.0
g_raw[1, 0]    0.746  0.246     0.303      1.226      0.007    0.005    1056.0     957.0    1.0
g_raw[1, 1]    0.640  0.215     0.254      1.063      0.006    0.004    1092.0    1102.0    1.0
g_raw[2, 0]    0.569  0.202     0.202      0.955      0.006    0.003    1123.0    1105.0    1.0
g_raw[2, 1]    0.692  0.243     0.274      1.198      0.007    0.004    1128.0    1148.0    1.0
h_raw[0, 0]    0.981  0.359     0.372      1.716      0.011    0.006    1053.0    1225.0    1.0
h_raw[0, 1]    0.665  0.244     0.244      1.165      0.007    0.004    1056.0    1246.0    1.0
h_raw[1, 0]    0.769  0.304     0.251      1.373      0.009    0.006    1076.0    1308.0    1.0
h_raw[1, 1]    0.649  0.313     0.170      1.260      0.007    0.008    1423.0    1490.0    1.0
h_raw[2, 0]    0.941  0.369     0.295      1.657      0.010    0.006    1191.0    1458.0    1.0
h_raw[2, 1]    0.991  0.464     0.234      1.933      0.010    0.008    1952.0    2093.0    1.0
v_raw[0, 0]    0.975  0.597     0.077      2.158      0.008    0.010    3906.0    2311.0    1.0
v_raw[0, 1]    0.936  0.606     0.039      2.113      0.008    0.009    3781.0    2116.0    1.0
v_raw[1, 0]    0.646  0.598     0.000      1.819      0.014    0.009    1059.0     727.0    1.0
v_raw[1, 1]    0.755  0.603     0.001      1.946      0.010    0.009    2017.0    1373.0    1.0
v_raw[2, 0]    0.786  0.608     0.001      1.977      0.010    0.009    2269.0    1195.0    1.0
v_raw[2, 1]    0.780  0.602     0.001      1.962      0.009    0.009    2906.0    2006.0    1.0
c₁_raw[0, 0]   0.932  0.592     0.045      2.082      0.009    0.009    3525.0    2086.0    1.0
c₁_raw[0, 1]   0.927  0.598     0.031      2.074      0.008    0.009    3902.0    2410.0    1.0
c₁_raw[1, 0]   0.704  0.621     0.002      1.893      0.011    0.010    1953.0    1767.0    1.0
c₁_raw[1, 1]   0.822  0.581     0.006      1.919      0.009    0.009    3242.0    2062.0    1.0
c₁_raw[2, 0]   0.318  0.490     0.002      1.418      0.011    0.011    1553.0    3387.0    1.0
c₁_raw[2, 1]   0.799  0.600     0.009      2.003      0.008    0.009    3473.0    2772.0    1.0
c₂_raw[0, 0]   0.300  0.112     0.116      0.526      0.003    0.002    1364.0    1744.0    1.0
c₂_raw[0, 1]   0.503  0.187     0.186      0.869      0.005    0.004    1330.0    1477.0    1.0
c₂_raw[1, 0]   0.335  0.131     0.115      0.577      0.004    0.003    1304.0    2088.0    1.0
c₂_raw[1, 1]   0.917  0.332     0.341      1.555      0.009    0.006    1383.0    1902.0    1.0
c₂_raw[2, 0]   1.239  0.464     0.462      2.167      0.010    0.007    1947.0    2264.0    1.0
c₂_raw[2, 1]   1.351  0.469     0.523      2.266      0.012    0.008    1368.0    1682.0    1.0
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="visualizing-the-curves">
<h2>Visualizing the curves<a class="headerlink" href="#visualizing-the-curves" title="Link to this heading">#</a></h2>
<p>Before plotting the curves, we have to generate predictions using the posterior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create prediction dataframe</span>
<span class="n">prediction_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_prediction_dataset</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Use the model to predict on the prediction dataframe</span>
<span class="n">predictive</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">prediction_df</span><span class="p">,</span> <span class="n">posterior</span><span class="o">=</span><span class="n">posterior</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This returns the posterior predictive distribution. We can use it to plot the estimated curves. Again, we specify the path where the generated PDF will be stored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;curves.pdf&quot;</span><span class="p">)</span>

<span class="c1"># Plot recruitment curves</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_curves</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">prediction_df</span><span class="o">=</span><span class="n">prediction_df</span><span class="p">,</span>
    <span class="n">predictive</span><span class="o">=</span><span class="n">predictive</span><span class="p">,</span>
    <span class="n">posterior</span><span class="o">=</span><span class="n">posterior</span><span class="p">,</span>
    <span class="n">encoder</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/2af04b2465d7ad99c8dbd44febda894254a5e4efae7699ffc65c7af0a4a1d8bf.png" src="../_images/2af04b2465d7ad99c8dbd44febda894254a5e4efae7699ffc65c7af0a4a1d8bf.png" />
</div>
</div>
<p>In each panel above, the top plot shows the estimated curve overlaid on data, and the bottom plot shows the posterior distribution of the threshold parameter.</p>
</section>
<section id="mixture-extension">
<h2>Mixture extension<a class="headerlink" href="#mixture-extension" title="Link to this heading">#</a></h2>
<p>The curves look good overall, except for participant P1 and muscle FCR, where the growth rate seems to be biased by a few data points.
This can be addressed with a mixture model. To enable it, we can add the following line at the end of the <a class="reference internal" href="#id2"><span class="std std-ref">model-building code</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable mixture model</span>
<span class="n">model</span><span class="o">.</span><span class="n">use_mixture</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="accessing-parameters">
<h2>Accessing parameters<a class="headerlink" href="#accessing-parameters" title="Link to this heading">#</a></h2>
<p>Each participant, muscle combination is assigned a tuple index, which can be used to access the curve parameters, which are stored in the <code class="docutils literal notranslate"><span class="pre">posterior</span></code> dictionary as NumPy arrays.
Here we show how to access the threshold parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hbmep.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">site</span>

<span class="c1"># Threshold parameter</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">a</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of a:	(4000, 3, 2)

First dimension corresponds to the number of samples:		4000
Second dimension corresponds to the number of participants:	3
Last dimension corresponds to the number of muscles:		2
</pre></div>
</div>
</div>
</div>
<p>By default, we have 4000 posterior samples (4 chains, 1000 samples each). We can set more chains or samples by updating the <a class="reference internal" href="#id2"><span class="std std-ref">model-building code</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use 10 chains, 2000 samples each, for a total of 20,000 samples</span>
<span class="n">model</span><span class="o">.</span><span class="n">mcmc_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_chains&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;thinning&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;num_warmup&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="s2">&quot;num_samples&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The other curve parameters can be accessed similarly using their keys.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site</span><span class="o">.</span><span class="n">b</span><span class="si">}</span><span class="s2"> controlds the growth rate&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">site</span><span class="o">.</span><span class="n">g</span><span class="si">}</span><span class="s2"> is the offset&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">site</span><span class="o">.</span><span class="n">g</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">site</span><span class="o">.</span><span class="n">h</span><span class="si">}</span><span class="s2">) is the saturation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>b controlds the growth rate
g is the offset
(g + h) is the saturation
</pre></div>
</div>
</div>
</div>
</section>
<section id="saving-the-model">
<h2>Saving the model<a class="headerlink" href="#saving-the-model" title="Link to this heading">#</a></h2>
<p>We can save the model, posterior samples, and other objects using pickle for later analysis.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>

<span class="c1"># Save the model</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;model.pkl&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">model</span><span class="p">,),</span> <span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved model to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Save the dataframe, encoder, and posterior samples</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;inference.pkl&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">df</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,),</span> <span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved samples to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Save the MCMC object</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">build_dir</span><span class="p">,</span> <span class="s2">&quot;mcmc.pkl&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">mcmc</span><span class="p">,),</span> <span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved MCMC object to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-other-functions">
<h2>Using other functions<a class="headerlink" href="#using-other-functions" title="Link to this heading">#</a></h2>
<p>Alternatively, we can use other functions to estimate the recruitment curves. The following choicej are available:</p>
<ul class="simple">
<li><p>logistic-4, also known as the Boltzmann sigmoid, is the most common function used to estimate recruitment curves</p></li>
<li><p>logistic-5, is a more generalized version of logistic-4</p></li>
<li><p>rectified-linear</p></li>
</ul>
<p>If estimating threshold is not important, we recommend using logistic-5 over logistic-4, which has a much better predictive performance.</p>
<p>For example, to use logistic-5 function, we need to update the <a class="reference internal" href="#id2"><span class="std std-ref">model-building code</span></a> and point to it, and rest of the tutorial remains the same.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the function to logistic-5</span>
<span class="n">model</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">logistic5</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../user/installation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A Simple Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-the-model">Build the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-model">Running the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-curves">Visualizing the curves</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mixture-extension">Mixture extension</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-parameters">Accessing parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-model">Saving the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-other-functions">Using other functions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023-2024, hbmep authors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>